'''
Created on May 1, 2020

@author: banyait
'''
import unittest
import pprint
from asb_usecases.wrappers.segmentation import process_wrapper
import os


class Test(unittest.TestCase):

    def testSentinelProductQuery(self):
        # the original geojson
        # test_fields='{"type": "FeatureCollection", "features": [{"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[5.044513529674481, 51.26160087557804], [5.081444061531247, 51.265948247889355], [5.069569491723419, 51.23958480921655], [5.089447905390232, 51.23266030591975], [5.107955128662347, 51.18926560336382], [4.988710193065534, 51.16818770929174], [4.969585772971755, 51.2407687290102], [5.009682764875103, 51.24654802222713], [5.044513529674481, 51.26160087557804]]]}, "properties": {}} ]}'
        test_tilesAndShapes='[{"31UFS": [{"type": "Feature", "properties": {}, "geometry": {"type": "Polygon", "coordinates": [[[5.044513529674481, 51.26160087557804, 0.0], [5.081444061531247, 51.265948247889355, 0.0], [5.069569491723419, 51.23958480921655, 0.0], [5.089447905390232, 51.23266030591975, 0.0], [5.107955128662347, 51.18926560336382, 0.0], [4.988710193065534, 51.16818770929174, 0.0], [4.969585772971755, 51.2407687290102, 0.0], [5.009682764875103, 51.24654802222713, 0.0], [5.044513529674481, 51.26160087557804, 0.0]]]}}]}]'
        #test_tilesAndShapes='[{"31UFS": [{"type": "Feature", "properties": {}, "geometry": {"type": "Polygon", "coordinates": [[[5.150182007618865, 51.27627936497805, 0.0], [5.163724766795926, 51.23318726304839, 0.0], [5.13132523118403, 51.09517147386529, 0.0], [5.049929532118568, 51.10881433222647, 0.0], [4.984592558980917, 51.1257140280139, 0.0], [4.979711965806779, 51.13658191042143, 0.0], [4.983805366533475, 51.14665711612321, 0.0], [4.983490489554501, 51.14888189091951, 0.0], [4.9773503884644565, 51.15144960514087, 0.0], [4.966329694200274, 51.16389111956099, 0.0], [4.96569994024232, 51.16872858023319, 0.0], [4.973414426227247, 51.17998111731467, 0.0], [4.974673934143155, 51.18205365357829, 0.0], [4.967304202481425, 51.21932802291116, 0.0], [4.957792173464138, 51.238542928067034, 0.0], [4.968655429238831, 51.24051426575423, 0.0], [5.009904313484771, 51.24593500880928, 0.0], [5.045013096640668, 51.26091264914376, 0.0], [5.0755561636014015, 51.26455778377334, 0.0], [5.08515991146019, 51.267217564442916, 0.0], [5.093504151403071, 51.268104123792824, 0.0], [5.101376075877487, 51.27076369922452, 0.0], [5.108303369414973, 51.27184718582646, 0.0], [5.120898448574038, 51.2753929633522, 0.0], [5.150182007618865, 51.27627936497805, 0.0]]]}}]}]'
        test_daterange='{"start": "2018-01-01", "end": "2018-12-31"}'
        test_result='[{"31UFS": "/home/banyait/test_segmentation_data/02_output_for_segmentation_post/0/31UFS_segmentedImage.tif"}]'
        
        output=process_wrapper.execute(
            '/home/banyait/test_segmentation_data/03_segment',
            os.path.join('/home/banyait/test_segmentation_data/01_original','CGS_S2_NDVI'), 
            '/home/banyait/test_segmentation_data/01_original',
            test_tilesAndShapes, 
            test_daterange
        )
        print(output)
        pprint.pprint(output)
         
        self.assertEqual(output['segmentedfiles_json'],test_result)
